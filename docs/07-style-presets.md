# Стили, пресеты и “style bible” (концептуально)

## Зачем это отдельной сущностью
Иллюстрации должны быть:
- в единой стилистике внутри проекта,
- воспроизводимы при перегенерации,
- переносимы между провайдерами/моделями (насколько это возможно).

Поэтому “стиль” — это не только картинка-референс, а **пакет артефактов**.

## StylePreset (концептуально)
`StylePreset` — именованный набор правил и материалов, используемый генерацией.

Рекомендуемые поля:
- **name**: человекочитаемое имя (“Акварельная книга 6–8”).
- **reference_images[]**: 1–5 изображений-референсов (источник визуального языка).
- **style_bible_text**: текстовая выжимка стиля (палитра, линии, материалы, композиция).
- **positive_rules**: явные требования (“мягкие линии”, “теплая палитра”, “без гиперреализма”).
- **negative_rules**: запреты (“без текста на картинке”, “без оружия”, “без пугающих деталей”).
- **default_formats**: какие форматы ассетов считаются базовыми (соотношение сторон/разрешение).
- **quality_bar**: минимальные требования качества (резкость/детализация/отсутствие артефактов) на уровне политики.

## Почему нельзя хранить только текстовое описание стиля
Текст полезен для промптов, но **референс-картинки лучше сохранять**:
- можно переизвлечь/пересобрать style bible в будущем,
- можно мигрировать между провайдерами/моделями,
- проще визуально проверить “не поплыл ли стиль”.

Компромисс:
- хранить и картинки, и текстовую выжимку.

## Извлечение “style bible” из референса
Допустимая стратегия:
- система/LLM генерирует первичное `style_bible_text` по референсу,
- менеджер правит/дополняет (один раз на пресет),
- дальше генерация использует эту выжимку как стабильный вход.

Важно:
- `style_bible_text` — это **артефакт пресета**, а не результат “на лету” на каждую задачу.

## Версионирование стиля (ключевая концепция)
Стиль нужно версионировать так же, как контент.

Например:
- изменение референса,
- изменение правил (negative/positive),
- изменение базовых форматов,

…должно увеличивать **ревизию пресета** (`style_preset_revision`).

Зачем:
- чтобы понимать, какие ассеты сгенерированы “по старому стилю”,
- чтобы корректно инвалидировать ассеты при изменении стиля.

## Как стиль влияет на идемпотентность задач
Идемпотентный ключ генерации должен учитывать ревизию стиля, например:
- (version_id, scene_id, format, **style_preset_revision**)

Тогда:
- перегенерация при неизменном стиле не плодит “параллельные истины”,
- смена стиля автоматически означает новый набор задач/ассетов.

## Пресеты генерации vs StylePreset
Не путать:
- **StylePreset**: визуальный язык (как выглядит).
- **GenerationPreset** (или “контентный пресет”): сколько сцен/иллюстраций, лимиты перегенераций, бюджеты (сколько генерить).

Они комбинируются:
- произведение выбирает *style preset* + *generation preset*.

## Минимальный MVP (что достаточно)
Для старта достаточно:
- 1 `StylePreset` с 1 референсом,
- `style_bible_text`, сгенерированный и подправленный вручную,
- список запретов (минимум: “без текста на изображении”).

