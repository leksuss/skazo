# Модель контента (канонический слой)

## Почему так
Модель должна позволять:
- рендерить “книгу” на разных устройствах без пересохранения “страниц”,
- привязывать иллюстрации к смыслу,
- хранить историю правок и пере-генерации ассетов.

## Базовые сущности (концептуально)

### Story (Произведение)
- метаданные: название, язык, возраст, теги, статус публикации;
- связь с версиями текста и ассетами.

### Source (Источник)
Оригинал, из которого получен текст:
- файл/URL (для MVP достаточно файла),
- артефакты извлечения (опционально).

### StoryVersion (Версия произведения)
Важная идея: любые изменения текста/якорей/описаний сцен делаются **через новую версию**.

Содержит:
- “канонический” структурированный текст (блоки),
- сцены,
- якоря,
- связанный набор ассетов (или ссылки на них).

### Block (Блок текста)
Минимально: абзац. Дополнительно: заголовок, реплика диалога, разделитель.

Ключевое:
- **стабильный идентификатор** (чтобы якоря жили при правках),
- порядок,
- текст,
- тип/метаданные.

### Scene (Сцена / эпизод)
Группирует блоки в смысловые куски:
- границы сцен,
- краткое описание сцены (для генерации ассетов),
- список персонажей/локаций (опционально, можно позже).

### Anchor (Якорь)
Привязка ассета к тексту:
- “после Block X” или “к Scene Y”,
- не зависит от “страницы”.

### Asset (Ассет)
Изображение/видео, как результат генерации или загрузки:
- тип (image/video),
- вариации (несколько попыток),
- размеры/соотношения сторон,
- статус ревью (pending/approved/rejected).

### GenerationTask (Задача генерации)
Фоновые задачи, которые создают/обновляют ассеты:
- промпт/параметры,
- ссылки на сцену/якорь,
- статус/ошибки/ретраи,
- идемпотентный ключ.

## Версионирование и неизменяемость
Рекомендуемая политика:
- опубликованная версия “заморожена”;
- правки идут как новая версия;
- читательская читалка всегда читает “активную опубликованную версию”.

## Пресеты (концептуально)
Наборы “как много иллюстраций”:
- короткий: 2–4 сцены/иллюстрации,
- средний: 6–10,
- длинный: 12–18.

Пресет влияет на:
- сколько якорей создавать по умолчанию,
- лимиты перегенераций,
- бюджет генерации.
